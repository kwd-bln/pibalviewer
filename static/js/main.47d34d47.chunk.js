(this.webpackJsonppibalviewer=this.webpackJsonppibalviewer||[]).push([[0],{111:function(e,t,n){e.exports=n(125)},120:function(e,t,n){},125:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(15),c=n.n(o),i=n(10),s=(n(120),n(16)),u=n(33),l=n(20),h=n(21),p=n(23),f=n(24),d=n(7),m=n.n(d),g=n(19),b=n(58),v=Object(b.actionCreatorFactory)(),O=v("REQUEST_LOGIN"),E=v("INPUT_USER"),T=v("INPUT_PASS"),I=v("START_LOADING"),j=v("FINISH_LOADING"),k=v("START_CREATE_TOKEN"),w=v("FINISH_CREATE_TOKEN"),x=v("START_FETCH_DATES"),L=v("FINISH_FETCH_DATES"),S=v("START_FETCH_PIBALDATA"),y=v("FINISH_FETCH_PIBALDATA"),_=v("ACTION_ENLARGE"),A=v("ACTION_SHRINK"),C=v("TOGGLE_VISIBLE"),P=v("SELECT_FLIGHT"),D=(v("GET_DATA_ERROR"),v("LOAD_DATA_ERROR"),v("FETCHED_DATA"),v("SET_DATES")),M=v("SET_WIND"),N=console.log.bind(console),R=function(e){return function(){var t=Object(g.a)(m.a.mark((function t(n){var a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=localStorage.auth_token){t.next=3;break}return t.abrupt("return");case 3:return n(I()),t.next=6,fetch("https://oval-silicon-280513.an.r.appspot.com/api/v1/successLogin",{headers:{"x-access-token":a}}).then((function(e){return e.json()})).then((function(t){t.success?n(O(a)):localStorage.clear(),n(j()),e.push("/")})).catch((function(e){console.log(e),n(j())}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},F=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={isLoading:!1},a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=Object(g.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Auth componentWillMount!!",this.props.loading),this.props.loading||this.props.login){e.next=5;break}return N("this.props componentDidMount",this.props),e.next=5,this.props.handleSetLoginState(this.props.history);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return console.log("authRender",this.props.loading),this.props.loading?r.a.createElement("div",null,"loading"):this.props.login?(console.log("Go to Top page"),r.a.createElement(s.b,{children:this.props.children})):(console.log("Go to Login page"),r.a.createElement(s.a,{to:"/login"}))}}]),n}(r.a.Component),H=Object(s.f)(Object(i.c)((function(e){return{login:e.state.login,token:e.state.token,loading:e.state.loading}}),(function(e){return{handleSetLoginState:function(){var t=Object(g.a)(m.a.mark((function t(n){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,R(n)(e);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}}))(F)),V=function(e){var t=e.value;return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{type:"text",value:t,onChange:function(t){return e.onChangeValue(t.target.value)}}))},B=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"handleSubmit",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props.username,a=this.props.password,e.next=4,this.props.handleOnClickSubmitButton(n,a,this.props.history);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderSubmit",value:function(){return this.props.creatingToken?r.a.createElement("p",null,"Loading"):r.a.createElement("input",{type:"submit",value:"Send"})}},{key:"render",value:function(){var e=this;return console.log("login render",this.props.loading,this.props.login),r.a.createElement("div",null,r.a.createElement("p",null,"\u672a\u30ed\u30b0\u30a4\u30f3"),r.a.createElement("form",{onSubmit:function(t){return e.handleSubmit(t)}},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"name"),r.a.createElement("p",null,r.a.createElement(V,{name:"name",value:this.props.username,onChangeValue:this.props.handleOnChangeValueOfUserInput}))),r.a.createElement("li",null,r.a.createElement("p",null,"Password"),r.a.createElement("p",null,r.a.createElement(V,{name:"pass",value:this.props.password,onChangeValue:this.props.handleOnChangeValueOfPassInput})))),this.renderSubmit()))}}]),n}(r.a.Component),G=Object(s.f)(Object(i.c)((function(e){return{login:e.state.login,loading:e.state.loading,username:e.state.username,password:e.state.password,creatingToken:e.state.creatingToken}}),(function(e){return{handleClickLoginButton:function(){e(O("aaa"))},handleOnChangeValueOfUserInput:function(t){e(E(t))},handleOnChangeValueOfPassInput:function(t){e(T(t))},handleOnClickSubmitButton:function(){e(k())}}}))(B)),U=n(14),K=Object(U.a)(),W=n(63),J=function(e){var t=e.dateInfoList.map((function(e,t){return{value:t,label:"".concat(re(e.date)," - ").concat(e.timePeriod)}}));return t.length?r.a.createElement("div",{className:"select-dates-div"},r.a.createElement(W.a,{options:t,defaultValue:t[0],className:"dates-select",onChange:function(t){var n=t.value;e.onChange(n)}})):r.a.createElement("p",null,"nodata")};var Y=function(e){var t=Object(a.useRef)(null);return Object(a.useEffect)((function(){var n=[];e.windInfoList.forEach((function(e){var t=[],a=0,r=0;e.winds.forEach((function(e){var n=e.deg*(Math.PI/180);a+=30.8667*e.spd*Math.sin(n),r+=30.8667*e.spd*Math.cos(n),t.push({x:a,y:r})})),n.push({hours:e.hours,minutes:e.minutes,visible:e.visible,points:t})})),console.log(e.windInfoList.map((function(e){return e.winds})));var a=function(e){var t=function(e,t){return Math.max(e,t)};return e.map((function(e){return e.points.map((function(e){return Math.hypot(e.x,e.y)})).reduce(t)})).reduce(t,1)}(n),r=function(){var e=t.current;return e.width=480,e.height=480,e.getContext("2d")}(),o=function(e){var t=Math.ceil(e/3.2);return Math.max(Number(t.toPrecision(2)),10)}(a),c=48/o;console.log("maxR = ",a,"scale",c,o),r.save(),r.strokeStyle="#707070",r.fillStyle="#707070",r.beginPath(),r.moveTo(240,240),r.arc(240,240,2,0,2*Math.PI),r.fill();var i=t.current.width-50,s=t.current.height-50;r.beginPath(),r.moveTo(50,240),r.lineTo(i,240),r.moveTo(240,50),r.lineTo(240,s),r.moveTo(50,50),r.lineTo(i,s),r.moveTo(i,50),r.lineTo(50,s),r.stroke(),r.beginPath(),r.moveTo(240,240),r.arc(240,240,48,0,2*Math.PI),r.arc(240,240,96,0,2*Math.PI),r.arc(240,240,144,0,2*Math.PI),r.stroke(),r.beginPath();r.moveTo(.3*i,s),r.lineTo(.3*i,s+10),r.lineTo(.3*i+48,s+10),r.lineTo(.3*i+48,s),r.stroke(),r.restore(),r.save(),r.fillStyle="black",r.font="10px",r.textAlign="center",r.fillText(o.toString()+"m",.3*i+24,s+25),r.restore();var u=n.length;console.log(n);var l=Math.min(360/u,40);n.forEach((function(e,t){if(e.visible){var n=e.points,a=Math.ceil(l*t),o="hsl("+a+", 100%, 50%)",i="hsl("+a+", 80%, 45%)",s=240,u=240;n.forEach((function(e){r.save(),r.strokeStyle=o,r.fillStyle=i,r.beginPath(),r.moveTo(s,u),s=240+e.x*c,u=240-e.y*c,r.lineTo(s,u),r.stroke(),r.moveTo(s,u),r.arc(s,u,3,0,2*Math.PI),r.fill(),r.restore()}))}}))})),r.a.createElement("div",{className:"rect-wrap"},r.a.createElement("canvas",{className:"pibal-glaph",ref:t}))},Q=n(25),z=n(46);var X=function(e){var t=e.arrow,n=e.position,o=e.id,c="arrow-".concat(o);return Object(a.useEffect)((function(){var e=z.b(".".concat(c)),a=function(e){var t=Math.cos(e.rad),n=Math.sin(e.rad);return{x0:-e.length*n/2,y0:e.length*t/2,x1:e.length*n/2,y1:-e.length*t/2,color:"hsl(".concat(e.hue,",50%,50%)")}}(t);e.append("defs").append("marker").attr("id","arrowhead-".concat(o)).attr("refX",1).attr("refY",2).attr("markerWidth",4).attr("markerHeight",4).attr("orient","auto").append("path").attr("d","M 0,0 V 4 L4,2 Z").attr("fill",a.color);var r=z.a().x((function(e){return e[0]})).y((function(e){return e[1]}));e.append("path").attr("d",r([[a.x0,a.y0],[a.x1,a.y1]])).attr("stroke",a.color).attr("stroke-width",2).attr("fill","none").attr("marker-end","url(#arrowhead-".concat(o,")")).attr("transform","translate(".concat(n.x,", ").concat(n.y,")"))})),r.a.createElement("g",{className:c,key:o})},Z=function(e){var t=e.children,n=e.width,a=e.height;return r.a.createElement("svg",{style:{width:n,height:a}},t)},$=function(e){if(!e.windInfoList.length)return null;var t=Math.max.apply(Math,Object(Q.a)(e.windInfoList.map((function(e){return Math.max.apply(Math,Object(Q.a)(e.winds.map((function(e){return e.spd}))))})))),n=Math.min.apply(Math,Object(Q.a)(e.windInfoList.map((function(e){return Math.min.apply(Math,Object(Q.a)(e.winds.map((function(e){return e.spd}))))})))),a=Math.max.apply(Math,Object(Q.a)(e.windInfoList.map((function(e){return e.winds.length})))),o=e.windInfoList.length,c=30*o,i=30*a,s=0;return r.a.createElement(Z,{width:c,height:i},e.windInfoList.map((function(a,o){return a.winds.map((function(a,c){s++;var u,l={length:(u=a.spd,4+11/(t-n)*u),rad:a.deg/180*Math.PI,hue:a.deg},h={x:30*o+10,y:i-30*c-10};return r.a.createElement(X,{arrow:l,position:h,id:"".concat(e.selectedId,"-").concat(s),key:s})}))})))},q=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"componentDidMount",value:function(){if(console.log("componentDidMount"),this.props.token)if(0===this.props.dateInfoList.length)console.log("fetch LoadDates"),this.props.handleOnLoadDates(this.props.token);else if(this.props.selected&&0===this.props.selected.windInfoList.length){var e=this.props.selected;this.props.handleOnLoadPiabalInfo(e.date,e.timePeriod,this.props.token)}}},{key:"componentDidUpdate",value:function(){if(this.props.token&&(console.log("fetch LoadPibalInfo"),this.props.selected&&0===this.props.selected.windInfoList.length)){var e=this.props.selected;this.props.handleOnLoadPiabalInfo(e.date,e.timePeriod,this.props.token)}}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(J,{dateInfoList:this.props.dateInfoList,onChange:this.props.handleOnChangeValue}),function(){if(e.props.selected)return r.a.createElement("div",null,r.a.createElement(Y,{windInfoList:e.props.selected.windInfoList}),r.a.createElement($,{selectedId:e.props.selected.id,windInfoList:e.props.selected.windInfoList}))}())}}]),n}(r.a.Component),ee=Object(i.c)((function(e){return{token:e.state.token,fetchingDates:e.state.fetchingDates,fetchingPibalData:e.state.fetchingPibalData,scale:e.state.scale,selected:e.state.selected,dateInfoList:e.state.dateInfoList}}),(function(e){return{handleClickEnlargeButton:function(){e(_())},handleClickShrinkButton:function(){e(A())},handleOnChangeValue:function(t){e(P(t))},handleOnSelectToggleButton:function(t){e(C(t))},handleOnLoadDates:function(t){te(t)(e)},handleOnLoadPiabalInfo:function(t,n,a){ne(t,n,a)(e)}}}))(q),te=function(e){return function(t){t(x()),fetch("https://oval-silicon-280513.an.r.appspot.com/api/v1/dates",{headers:{"x-access-token":e}}).then((function(e){return e.json()})).then((function(e){console.log("fetchDate",e);var n=e.data.map((function(e,t){return{id:t,date:ae(e.date),timePeriod:e.timing}}));n.sort((function(e,t){return e.date.getTime()-t.date.getTime()})),t(D(n)),t(L()),0!==n.length&&t(P(0))})).catch((function(e){console.log("error in fetchDetes:",e),t(L())}))}},ne=function(e,t,n){return function(a){!function(e,t,n,a){var r=function(e){var t=e.getFullYear().toString(),n=("00"+e.getMonth()).slice(-2),a=("00"+e.getDate()).slice(-2);return t+n+a}(t);e(S()),fetch("https://oval-silicon-280513.an.r.appspot.com/api/v1/".concat(r,"/").concat(n),{headers:{"x-access-token":a}}).then((function(e){return e.json()})).then((function(t){if(t.data.length){var n=[];t.data[0].infos.forEach((function(e){var t=e.hours,a=e.minutes,r=e.winds.map((function(e){return{alt:e.height,deg:e.degree,spd:e.speed}}));n.push({hours:t,minutes:a,winds:r,visible:!0})})),e(M(n)),e(y())}})).catch((function(t){console.log("error in getPibalInfo:",t),e(y())}))}(a,e,t,n)}};function ae(e){var t=Number(e.slice(0,4)),n=Number(e.slice(4,6)),a=Number(e.slice(6));return new Date(t,n,a)}function re(e){return e.getFullYear().toString()+"/"+("00"+e.getMonth()).slice(-2)+"/"+("00"+e.getDate()).slice(-2)}var oe=function(){return r.a.createElement(u.a,{history:K},r.a.createElement(s.d,null,r.a.createElement(s.b,{path:"/login",component:G}),r.a.createElement(H,null,r.a.createElement(s.b,{exact:!0,path:"/",component:ee}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ce=n(17),ie=n(64),se=n(6),ue=n(60),le={login:!1,token:"",username:"",password:"",loading:!1,creatingToken:!1,fetchingDates:!1,fetchingPibalData:!1,hasError:!1,scale:1,selected:void 0,dateInfoList:[]},he=Object(ue.reducerWithInitialState)(le).case(I,(function(e){return Object(se.a)({},e,{loading:!0})})).case(j,(function(e){return Object(se.a)({},e,{loading:!1})})).case(k,(function(e){return Object(se.a)({},e,{creatingToken:!0})})).case(w,(function(e){console.log("FinishCreateTokenAction");return Object(se.a)({},e,{creatingToken:!1})})).case(E,(function(e,t){return Object(se.a)({},e,{username:t})})).case(T,(function(e,t){return Object(se.a)({},e,{password:t})})).case(x,(function(e){console.log("startFetchDatesAction");return Object(se.a)({},e,{fetchingDates:!0})})).case(L,(function(e){console.log("FinishFetchDatesAction");return Object(se.a)({},e,{fetchingDates:!1})})).case(S,(function(e){return Object(se.a)({},e,{fetchingPibalData:!0})})).case(y,(function(e){return Object(se.a)({},e,{fetchingPibalData:!1})})).case(_,(function(e){var t=Math.min(e.scale+.1,2);return Object(se.a)({},e,{scale:t})})).case(A,(function(e){var t=Math.max(e.scale-.1,.5);return Object(se.a)({},e,{scale:t})})).case(D,(function(e,t){return Object(se.a)({},e,{dateInfoList:t})})).case(M,(function(e,t){if(e.selected){var n=Object(se.a)({},e.selected,{windInfoList:t});return Object(se.a)({},e,{selected:n})}return e})).case(P,(function(e,t){var n=e.dateInfoList.find((function(e){return e.id===t}));if(n){var a={id:t,date:n.date,timePeriod:n.timePeriod,windInfoList:[]};return Object(se.a)({},e,{selected:a})}return Object(se.a)({},e)})).case(C,(function(e,t){var n=e.selected;if(n){var a=n.windInfoList[t].visible;return n.windInfoList[t].visible=!a,Object(se.a)({},e,{selected:n})}return e})).case(O,(function(e,t){return console.log("Login Action",!0,t),Object(se.a)({},e,{login:!0,token:t})})).build(),pe=n(61),fe=n(9);function de(e,t){var n=JSON.stringify({postUser:e,postPass:t});return console.log("authorize",n),fetch("https://oval-silicon-280513.an.r.appspot.com/api/v1/authenticate",{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",headers:{"content-type":"application/json; charset=UTF-8"},body:n}).then((function(e){return e.json()})).then((function(e){return e.success?(localStorage.setItem("auth_token",e.token),{token:e.token}):{error:"such user is not exist"}})).catch((function(e){return console.log("fetch error: ",e),{error:e}}))}var me=function(e){return e.state.username},ge=function(e){return e.state.password},be=m.a.mark(Ee),ve=m.a.mark(Te),Oe=m.a.mark(Ie);function Ee(){var e,t,n,a,r;return m.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=3,Object(fe.e)("START_CREATE_TOKEN");case 3:return o.next=5,Object(fe.d)(me);case 5:return e=o.sent,o.next=8,Object(fe.d)(ge);case 8:return t=o.sent,o.next=11,Object(fe.a)(de,e,t);case 11:if(n=o.sent,a=n.token,r=n.error,console.log("action".concat("START_CREATE_TOKEN",", user: ").concat(e,", pass: ").concat(t,", token: ").concat(a,", error: ").concat(r)),a||!r){o.next=19;break}return o.next=18,Object(fe.c)({type:"FINISH_CREATE_TOKEN"});case 18:return o.abrupt("continue",0);case 19:if(!a){o.next=24;break}return o.next=22,Object(fe.c)({type:"REQUEST_LOGIN",payload:a});case 22:return o.next=24,Object(fe.c)({type:"FINISH_CREATE_TOKEN"});case 24:o.next=0;break;case 26:case"end":return o.stop()}}),be)}function Te(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,Object(fe.e)("FINISH_CREATE_TOKEN");case 3:return console.log("FINISH_CREATE_TOKEN","aaaa"),console.log(),e.next=7,Object(fe.c)(Object(pe.push)("/"));case 7:e.next=0;break;case 9:case"end":return e.stop()}}),ve)}function Ie(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(fe.b)(Ee);case 2:return e.next=4,Object(fe.b)(Te);case 4:case"end":return e.stop()}}),Oe)}var je=n(62),ke=n.n(je),we=n(56);var xe=function(e){var t=Object(ie.a)(),n=Object(ce.e)(Object(ce.c)({state:he,router:Object(u.b)(K)}),e,Object(ce.a)(t,ke.a,Object(we.a)(K)));return t.run(Ie),n}();c.a.render(r.a.createElement(i.a,{store:xe},r.a.createElement(oe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[111,1,2]]]);
//# sourceMappingURL=main.47d34d47.chunk.js.map